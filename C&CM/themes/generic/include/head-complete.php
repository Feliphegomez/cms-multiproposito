
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<!-- Meta, title, CSS, favicons, etc. -->
		<meta http-equiv="Content-Language" content="es"/>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" href="<?php echo $this->getDirTheme(); ?>/assets/images/favicon.ico" type="image/ico" />
		<title><?php echo $this->getTitle(); ?></title>
		<!-- Bootstrap -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<!-- Font Awesome -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
		<!-- NProgress -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/nprogress/nprogress.css" rel="stylesheet">
		<!-- iCheck -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/iCheck/skins/flat/green.css" rel="stylesheet">
		<!-- bootstrap-progressbar -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet">
		<!-- JQVMap -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/jqvmap/dist/jqvmap.min.css" rel="stylesheet"/>
		<!-- bootstrap-daterangepicker -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
		<!-- Custom Theme Style -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/build/css/custom.min.css" rel="stylesheet">
		<!-- bootstrap-datetimepicker -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css" rel="stylesheet">
		<!-- Ion.RangeSlider -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/normalize-css/normalize.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/ion.rangeSlider/css/ion.rangeSlider.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/ion.rangeSlider/css/ion.rangeSlider.skinFlat.css" rel="stylesheet">
		<!-- Bootstrap Colorpicker -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/cropper/dist/cropper.min.css" rel="stylesheet">
		<!-- Datatables -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">

		<!-- bootstrap-wysiwyg -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/google-code-prettify/bin/prettify.min.css" rel="stylesheet">
		<!-- Dropzone.js -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/dropzone/dist/min/dropzone.min.css" rel="stylesheet">
		<!-- jQuery -->
		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/jquery/dist/jquery.min.js"></script>
		<!-- Bootstrap -->
		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/bootstrap/dist/js/bootstrap.min.js"></script>
		<!-- validator -->
		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/validator/validator.js"></script>
		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/jquery-validation/jquery.validate.js"></script>
		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/bootbox/bootbox.min.js"></script>
		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/bootbox/bootbox.locales.min.js"></script>
		<!-- Notify.js -->
		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/notify.js/notify.min.js"></script>
		<!-- FullCalendar 3 -->
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/3.1.0/dist/fullcalendar.min.css" rel="stylesheet">
		<link href="<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/3.1.0/dist/fullcalendar.print.css" rel="stylesheet" media="print">
		<!-- //
		-->
		<!-- FullCalendar 4.3.1 -->
		<link href='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/core/main.css' rel='stylesheet' />
		<link href='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/daygrid/main.css' rel='stylesheet' />
		<link href='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/timegrid/main.css' rel='stylesheet' />
		<link href='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/list/main.css' rel='stylesheet' />
		<script src='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/core/main.js'></script>
		<script src='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/core/locales-all.js'></script>
		<script src='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/interaction/main.js'></script>
		<script src='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/daygrid/main.js'></script>
		<script src='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/timegrid/main.js'></script>
		<script src='<?php echo $this->getDirTheme(); ?>/assets/vendors/fullcalendar/4.3.1/packages/list/main.js'></script>

		<script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/daypilot/pro/javascript/scripts/daypilot-all.min.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-router/3.0.2/vue-router.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>

		<!-- https://github.com/nevins-b/javascript-bcrypt -->
		<!-- <script src="<?php echo $this->getDirTheme(); ?>/assets/vendors/javascript-bcrypt/bCrypt.js"></script> -->
		<script>
			Date.prototype.toMysqlFormat = function() {
				function twoDigits(d) {
					if(0 <= d && d < 10) return "0" + d.toString();
					if(-10 < d && d < 0) return "-0" + (-1*d).toString();
					return d.toString();
				}
				if(new Date("2015-01-01T00:00:00").toString() === new Date("2015-01-01T00:00:00").toUTCString()){
					return this.getUTCFullYear() + "-" + twoDigits(1 + this.getUTCMonth()) + "-" + twoDigits(this.getUTCDate()) + " " + twoDigits(this.getUTCHours()) + ":" + twoDigits(this.getUTCMinutes()) + ":" + twoDigits(this.getUTCSeconds());
				}else{
					return this.getFullYear() + "-" + twoDigits(1 + this.getMonth()) + "-" + twoDigits(this.getDate()) + " " + twoDigits(this.getHours()) + ":" + twoDigits(this.getMinutes()) + ":" + twoDigits(this.getSeconds());
				}
			};

			Date.prototype.toConversationsFormat = function() {
				const now = new Date();
				const epochTime = this;
				const arrayMesesText = [
					'Enero',
					'Febrero',
					'Marzo',
					'Abril',
					'Mayo',
					'Junio',
					'Julio',
					'Agosto',
					'Septiembre',
					'Octubre',
					'Noviembre',
					'Diciembre'
				];
				isToday = (now.getDate() === this.getDate() && now.getMonth() === this.getMonth() && now.getFullYear() === this.getFullYear()) ? true : false;
				isYesterday = (now.getDate() === (this.getDate()+1) && now.getMonth() === this.getMonth() && now.getFullYear() === this.getFullYear()) ? true : false;
				totalDays = (now.getMonth() === this.getMonth() && now.getFullYear() === this.getFullYear()) ? (now.getDate() - this.getDate()) : 999;

				texto_start = 'Hace ';
				tiempo = '';
				if (isToday === true){
					horas = now.getHours() - this.getHours();
					if (horas >= 1){
						texto_start = 'Hace ';
						texto_end = ' hora(s)';
						tiempo = horas;
					} else if (horas < 1){
						minutos = now.getMinutes() - this.getMinutes();
						texto_start = 'Hace ';
						texto_end = ' minuto(s)';
						tiempo = minutos;
					}
				} else if (isYesterday === true){
					texto_start = 'Ayer ';
					texto_end = ' ';
					tiempo = null;
				} else if (totalDays <= 30){
					texto_start = 'Hace ';
					texto_end = ' días(s)';
					tiempo = totalDays;
				} else {
					mesText = arrayMesesText[this.getMonth()]
					texto_start = this.getDate() + ' de ' + mesText + ' ';
					texto_end = this.format('H:s');
					tiempo = null;
					//return this.format('d M H:s');
				}
				if(tiempo == null){
					return texto_start + texto_end;
				}else{
					if(tiempo>0){
						return texto_start + tiempo + texto_end;
					}else{
						return 'Dentro de ' + Number((tiempo)-tiempo*2) + texto_end;
					}
				}

			};
		</script>
		<script>
			function zfill(number, width) {
				var numberOutput = Math.abs(number);
				var length = number.toString().length;
				var zero = "0";
				if (width <= length) {
					if (number < 0) { return ("-" + numberOutput.toString()); }
					else { return numberOutput.toString(); }
				} else {
					if (number < 0) { return ("-" + (zero.repeat(width - length)) + numberOutput.toString()); }
					else { return ((zero.repeat(width - length)) + numberOutput.toString()); }
				}
			};
			function formatMoney(n, c, d, t){
				var c = isNaN(c = Math.abs(c)) ? 2 : c,
					d = d == undefined ? "." : d,
					t = t == undefined ? "," : t,
					s = n < 0 ? "-" : "",
					i = String(parseInt(n = Math.abs(Number(n) || 0).toFixed(c))),
					j = (j = i.length) > 3 ? j % 3 : 0;
				return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
			};

			var api = axios.create({
				baseURL: '/api.php',
				withCredentials: true,
				headers: {
					'X-CORE': 'api'
				}
			});

			api.interceptors.response.use(function (response) {
				if (response.headers['x-xsrf-token']) {
					document.cookie = 'XSRF-TOKEN=' + response.headers['x-xsrf-token'] + '; path=/';
				}
				return response;
			});

			var util = {
			  methods: {
				resolve: function (path, obj) {
				  return path.reduce(function(prev, curr) {
					return prev ? prev[curr] : undefined
				  }, obj || this);
				},
				getDisplayColumn: function (columns) {
				  var index = -1;
				  var names = ['name', 'title', 'description', 'username'];
				  for (var i in names) {
					index = columns.indexOf(names[i]);
					if (index >= 0) {
					  return names[i];
					}
				  }
				  return columns[0];
				},
				getPrimaryKey: function (properties) {
				  for (var key in properties) {
					if (properties[key]['x-primary-key']) {
					  return key;
					}
				  }
				  return false;
				},
				getReferenced: function (properties) {
				  var referenced = [];
				  for (var key in properties) {
					if (properties[key]['x-referenced']) {
					  for (var i = 0; i < properties[key]['x-referenced'].length; i++) {
						referenced.push(properties[key]['x-referenced'][i].split('.'));
					  }
					}
				  }
				  return referenced;
				},
				getReferences: function (properties) {
				  var references = {};
				  for (var key in properties) {
					if (properties[key]['x-references']) {
					  references[key] = properties[key]['x-references'];
					} else {
					  references[key] = false;
					}
				  }
				  return references;
				},
				getProperties: function (action, subject, definition) {
				  if (action == 'list') {
					path = ['components', 'schemas', action + '-' + subject, 'properties', 'records', 'items', 'properties'];
				  } else {
					path = ['components', 'schemas', action + '-' + subject, 'properties'];
				  }
				  return this.resolve(path, definition);
				}
			  }
			};

			var orm = {
			  methods: {
				readRecord: function () {
				  this.id = this.$route.params.id;
				  this.subject = this.$route.params.subject;
				  this.record = null;
				  var self = this;
				  api.get('/records/' + this.subject + '/' + this.id).then(function (response) {
					self.record = response.data;
				  }).catch(function (error) {
					console.log(error);console.log(error.response);
				  });
				},
				readRecords: function () {
				  this.subject = this.$route.params.subject;
				  this.records = null;
				  var url = '/records/' + this.subject;
				  var params = [];
				  for (var i=0;i<this.join.length;i++) {
					params.push('join='+this.join[i]);
				  }
				  if (this.field) {
					params.push('filter='+this.field+',eq,'+this.id);
				  }
				  if (params.length>0) {
					url += '?'+params.join('&');
				  }
				  var self = this;
				  api.get(url).then(function (response) {
					self.records = response.data.records;
				  }).catch(function (error) {
					console.log(error);console.log(error.response);
				  });
				},
				readOptions: function() {
				  this.options = {};
				  var self = this;
				  for (var key in this.references) {
					var subject = this.references[key];
					if (subject !== false) {
					  var properties = this.getProperties('list', subject, this.definition);
					  var displayColumn = this.getDisplayColumn(Object.keys(properties));
					  var primaryKey = this.getPrimaryKey(properties);
					  api.get('/records/' + subject + '?include=' + primaryKey + ',' + displayColumn).then(function (subject, primaryKey, displayColumn, response) {
						self.options[subject] = response.data.records.map(function (record) {
						  return {key: record[primaryKey], value: record[displayColumn]};
						});
						self.$forceUpdate();
					  }.bind(null, subject, primaryKey, displayColumn)).catch(function (error) {
						console.log(error);console.log(error.response);
					  });
					}
				  }
				},
				updateRecord: function () {
				  api.put('/records/' + this.subject + '/' + this.id, this.record).then(function (response) {
					console.log(response.data);
				  }).catch(function (error) {
					console.log(error);console.log(error.response);
				  });
				  router.push({name: 'List', params: {subject: this.subject}});
				},
				initRecord: function () {
				  this.record = {};
				  for (var key in this.properties) {
					if (!this.properties[key]['x-primary-key']) {
					  if (this.properties[key].default) {
						this.record[key] = this.properties[key].default;
					  } else {
						this.record[key] = '';
					  }
					}
				  }
				},
				createRecord: function() {
				  var self = this;
				  api.post('/records/' + this.subject, this.record).then(function (response) {
					self.record.id = response.data;
				  }).catch(function (error) {
					console.log(error);console.log(error.response);
				  });
				  router.push({name: 'List', params: {subject: this.subject}});
				},
				deleteRecord: function () {
				  api.delete('/records/' + this.subject + '/' + this.id).then(function (response) {
					console.log(response.data);
				  }).catch(function (error) {
					console.log(error);console.log(error.response);
				  });
				  router.push({name: 'List', params: {subject: this.subject}});
				}
			  }
			};
		</script>
<style>
	/*////////// SCROLLBAR ////////*/
	::-webkit-scrollbar {
	  width: 5px;
	}
	::-webkit-scrollbar:hover {
	  width: 10px;
	}
	::-webkit-scrollbar-track {
		background: #000;
	}
	::-webkit-scrollbar-thumb {
		background: #D33;
	}
	::-webkit-scrollbar-thumb:hover {
		background: #E44;
	}
</style>


<template id="Forms-Create-Diynamic">
	<div>
		<div class="x_title">
			<h2>{{ title }} <small>{{ subtitle }} </small></h2>
			<div class="clearfix"></div>
		</div>
		<form id="jvalidate" role="form" class="form-horizontal-" action="javascript:false;">
			<p v-html="contentDescription"></p>
			<div class="clearfix"></div>
			<br />

			<template v-if="inputs !== null">
				<div class="col-sm-12">
					<div class="row">
						<template v-for="(item, i) in inputs">
							<template class="item form-group" v-if="item.show === true">
								<template v-if="item.tag === 'span'">
									<div class="col-sm-12">
										<span class="section" v-if="item.type === 'section'">{{ item.title }}</span>
										<div class="clearfix"></div>
									</div>
								</template>
								<template v-else="">
									<div :class="'col-sm-' + options_form.style.columns_size + ' col-xs-12'">
										<label :class="'control-label col-sm-' + options_form.style.label_size + ' col-xs-12'" v-bind:for="'id-' + item.name">
											{{ item.label }} <span class="required" v-if="item.required === true">*</span>
										</label>
										<div :class="'control-label col-sm-' + options_form.style.input_size + ' col-xs-12'">
											<input class="form-control col-xs-12" v-if="item.tag === 'input'"
												:id="'id-' + item.name"
												:name="item.name"
												:required="item.required"
												:readonly="item.readonly"
												:disabled="item.disabled"
												:type="item.type"
												:title="item.title"
												v-model="record[item.name]"
											/>
											<select v-if="item.tag === 'select'" class="form-control col-xs-12"
												:id="'id-' + item.name"
												:name="item.name"
												:required="item.required"
												:readonly="item.readonly"
												:disabled="item.disabled"
												:type="item.type"
												:title="item.title"
												v-model="record[item.name]"
											>
												<option :value="option.value" v-if="item.options != undefined && item.options != null" v-for="(option, index) in item.options">{{ option.text }}</option>
											</select>
											<textarea v-if="item.tag === 'textarea'" class="form-control col-xs-12"
												:id="'id-' + item.name"
												:name="item.name"
												:required="item.required"
												:readonly="item.readonly"
												:disabled="item.disabled"
												:title="item.title"
												v-model="record[item.name]"
												rows="5"
											>{{ record[item.name] }}</textarea>

											<template v-if="item.dynamic == true" class="row">
												<div class="row" v-for="(subItem, j) in item.dynamicOptions.inputs">
													<template v-if="subItem.show === true">
														<label class="control-label col-sm-4" v-bind:for="'id-' + subItem.name">
															{{ subItem.label }} <span class="required" v-if="subItem.required === true">*</span>
														</label>
														<div class="col-sm-8">
															<input class="form-control col-xs-12" v-if="subItem.tag === 'input'"
																:id="'id-' + subItem.name"
																:name="subItem.name"
																:required="subItem.required"
																:readonly="subItem.readonly"
																:disabled="subItem.disabled"
																:type="subItem.type"
																:title="subItem.title"
																v-model="otherRecords[subItem.name]"
																@change="changeSubItem(item, subItem)"
															/>
															<select v-if="subItem.tag === 'select'" class="form-control col-xs-12"
																:id="'id-' + subItem.name"
																:name="subItem.name"
																:required="subItem.required"
																:readonly="subItem.readonly"
																:disabled="subItem.disabled"
																:type="subItem.type"
																:title="subItem.title"
																v-model="otherRecords[subItem.name]"
																@change="changeSubItem(item, subItem)"
															>
																<option :value="option.value" v-if="subItem.options != undefined && subItem.options != null" v-for="(option, index) in subItem.options">{{ option.text }}</option>
															</select>
															<textarea v-if="subItem.tag === 'textarea'" class="form-control col-xs-12"
																:id="'id-' + subItem.name"
																:name="subItem.name"
																:required="subItem.required"
																:readonly="subItem.readonly"
																:disabled="subItem.disabled"
																:title="subItem.title"
																v-model="otherRecords[subItem.name]"
																@change="changeSubItem(item, subItem)"
																rows="3"
															></textarea>
														</div>
													</template>
												</div>
											</template>
											<template v-else>
											</template>
										</div>
									</div>
								</template>
							</template>
							<template v-else="">
								<input class="form-control col-xs-12" v-if="item.tag === 'input'"
									:name="item.name"
									:required="item.required"
									:readonly="item.readonly"
									:disabled="item.disabled"
									:type="item.type"
									:title="item.title"
									v-model="record[item.name]"
								/>
								<template v-if="item.dynamic == true" class="row">
										<div class="row" v-for="(subItem, j) in item.dynamicOptions.inputs">
											<template v-if="subItem.show === true">
												<label class="control-label col-sm-4" v-bind:for="'id-' + subItem.name">
													{{ subItem.label }} <span class="required" v-if="subItem.required === true">*</span>
												</label>
												<div class="col-sm-8">
													<input class="form-control col-xs-12" v-if="subItem.tag === 'input'"
														:id="'id-' + subItem.name"
														:name="subItem.name"
														:required="subItem.required"
														:readonly="subItem.readonly"
														:disabled="subItem.disabled"
														:type="subItem.type"
														:title="subItem.title"
														v-model="otherRecords[subItem.name]"
														@change="changeSubItem(item, subItem)"
													/>
													<select v-if="subItem.tag === 'select'" class="form-control col-xs-12"
														:id="'id-' + subItem.name"
														:name="subItem.name"
														:required="subItem.required"
														:readonly="subItem.readonly"
														:disabled="subItem.disabled"
														:type="subItem.type"
														:title="subItem.title"
														v-model="otherRecords[subItem.name]"
														@change="changeSubItem(item, subItem)"
													>
														<option :value="option.value" v-if="subItem.options != undefined && subItem.options != null" v-for="(option, index) in subItem.options">{{ option.text }}</option>
													</select>
													<textarea v-if="subItem.tag === 'textarea'" class="form-control col-xs-12"
														:id="'id-' + subItem.name"
														:name="subItem.name"
														:required="subItem.required"
														:readonly="subItem.readonly"
														:disabled="subItem.disabled"
														:title="subItem.title"
														v-model="otherRecords[subItem.name]"
														@change="changeSubItem(item, subItem)"
														rows="3"
													></textarea>
												</div>
											</template>
										</div>
										Resultado => {{ item.result }}
									</template>
									<template v-else>
									<input class="form-control col-xs-12" v-if="item.tag === 'input'"
										:name="item.name"
										:required="item.required"
										:readonly="item.readonly"
										:disabled="item.disabled"
										:type="item.type"
										:title="item.title"
										v-model="record[item.name]"
									/></template>
							</template>
						</template>
					</div>
				</div>
			</template>
		<div class="clearfix"></div>
			<div class="ln_solid"></div>
			<div class="form-group">
				<div class="col-md-6 col-md-offset-3">
					<div class="big-button">
						<button type="reset" class="btn btn-default">Limpiar</button>
						<button type="submit" class="btn btn-success" onClick="javascript: $('#messageBox').html('');">Guardar</button>
					</div>
				</div>
			</div>
		</form>
		<div>
			<div class="clearfix"></div>
			<br />
			<div id="messageBox"></div>
			<p class="hide"> {{ record }}</p>
		</div>
	</div>
</template>

<script>
var FormsCreateDynamic = Vue.component('forms-create-dynamic', {
	template: '#Forms-Create-Diynamic',
	props: {
		'options_form': {
			'titulo': 'Crear',
			'tabla': '',
			'subtitulo': null,
			'descripcion': null,
			'style': {}
		}
	},
	data(){
		return {
			count: 0,
			action: "",
			title: "",
			subtitle: "",
			contentDescription: "",
			table: "",
			idUpdate: 0,
			rules: null,
			record: null,
			otherRecords: {},
			options: null,
			jvalidate: null,
			inputs: [],
			callEvent: null,
			originalRecords: {},
		};
	},
	computed: {
	},
	created(){
		var self = this;
		console.log("Creando formulario");
		if(!self.options_form.style){ self.options_form.style = {}; }
		if(!self.options_form.style.columns_size){ self.options_form.style.columns_size = 12; }
		if(!self.options_form.style.label_size){ self.options_form.style.label_size = 4; }
		if(!self.options_form.style.input_size){ self.options_form.style.input_size = 8; }
	},
	mounted(){
		var self = this;
		self.getOptionsInputs();
	},
	methods: {
		zfill: zfill,
		returnFalse(){
			return false;
		},
		changeSubItem(item, subItem){
			var self = this;
			self.record[item.name] = self.returnResultDynamic(item.result);
		},
		returnResultDynamic(itemResult){
			var self = this;
			var r = '';

			for (const [index, result] of  Object.entries(itemResult)) {
				if(!self.record[result.parent]){
					if (Array.isArray(result)) {
						r += self.returnResultDynamic(result);
						// r += '\n';
					} else if (self.otherRecords[result] !== undefined) {
						if (self.otherRecords[result] == '' || self.otherRecords[result] == null || self.otherRecords[result] == 0) {
							r += '{ Falta -> ' + result + '}';
						} else {
							r += self.otherRecords[result];
						};
					} else {
						console.log(result);
						if(!result.parent){
							r += '' + result;
						}else{
							// r += self.record[result.parent];
						}
					};
				}else{
					if(!self.originalRecords[result.parent]){ self.originalRecords[result.parent] = self.record[result.parent]; };
					if(self.record[result.parent] != self.originalRecords[result.parent]){ self.record[result.parent] = self.originalRecords[result.parent]; }
					console.log(result.parent);
					console.log(self.originalRecords[result.parent]);
					console.log(self.record[result.parent]);
					console.log(self.otherRecords[result.parent]);
					console.log(self.record[result.parent] + self.otherRecords[result.parent]);
					r += self.originalRecords[result.parent];
				}
			}
			return r;
		},
		getValidatorForm(){
			var self = this;


			if(
				self.idUpdate !== "" && self.idUpdate !== null && self.idUpdate !== undefined && self.idUpdate > 0
				&& self.action !== "" && self.action !== null && self.action !== undefined
			){
				switch(self.action){
					case 'edit':
						api.get('/records/' + self.table + '/' + self.idUpdate)
						.then(function (z) {
							if(z.data){
								for (const [k, v] of  Object.entries(z.data)) {
									// console.log(k, v);

									if(self.record.hasOwnProperty(k)){
										self.record[k] = v;
									}
								}
							}else{
								console.log("Console ERROR:");
							}
						})
						.catch(function (e) {
							console.log(e);
							if(e.data){
								console.log(e.data);
								console.log("Console catch ERROR:");
								console.log(e.response);
							}
						});
					break;
					default:
					break;
				}
			}else{
				console.log('error buscando registro');
				console.log(self.idUpdate);
			}

			self.jvalidate = $("#jvalidate").validate({
				//wrapper: "alert alert-danger alert-dismissible fade in",
				///errorContainer: "#messageBox",
				debug: true,
				//errorLabelContainer: "#messageBox",
				//wrapper: "strong",
				ignore: [],
				rules: self.rules,
				onsubmit: true,
				errorPlacement: function(error, element){
					var errorClone = error.clone();

					$("[name='" + element[0].name + "']").notify(
					  'El campo ' + element[0].title + ' esta vacio o llenado de forma erronea.',
					  {
						clickToHide: true,
						autoHide: true,
						autoHideDelay: 1000,
						className: 'error',
						showAnimation: 'slideDown',
						showDuration: 400,
						hideAnimation: 'slideUp',
						hideDuration: 200,
						position: 'top',
					});
					return false;
					/*
					var errorHTML = '<div class="alert alert-danger alert-dismissible fade in" role="alert">';
						errorHTML += '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>';
						errorHTML += 'El campo <strong>' + element[0].title + ' esta vacio o llenado de forma erronea.</strong>.';
					errorHTML += '</div>';
					$("#messageBox").append(errorHTML);

					*/
				},
				submitHandler: function(form){
					bootbox.confirm({
						message: "Debes confirmar que deseas continuar, una vez confirmes el envio/guardado no podras volver a modificar el contenido de esta informacion.",
						locale: 'es',
						buttons: {
							cancel: {
								label: '<i class="fa fa-times"></i> Cancelar'
							},
							confirm: {
								label: '<i class="fa fa-check"></i> Confirmar'
							}
						},
						callback: function (result) {
							if(result === true){
								switch(self.action){
									case 'create':
										api.post('/records/' + self.table, self.record)
										.then(function (z) {
											if(z.data){
												self.resposeCall(z);
											}else{
												console.log("Console ERROR:");
											}
										})
										.catch(function (e) {
											console.log("Console catch ERROR:", e.response);

											if(e.response.data){
												e.response.data.message = e.response.data.code == 1009 ? 'Ya existe una cuenta con estos campos.' : e.response.data.message;

												jQuery("#messageBox").html(
												'<div class="alert alert-danger alert-dismissible fade in" role="alert">'
													+ '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>'
													+ e.response.data.message
												+ '</div>');
												//self.resposeCall(e.response.data);
											}
										});
									break;
									case 'edit':
										api.put('/records/' + self.table + '/' + self.idUpdate, self.record)
										.then(function (z) {
											if(z.data){
												self.resposeCall(z);
											}else{
												console.log("Console ERROR:");
											}
										})
										.catch(function (e) {
											console.log("Console catch ERROR:", e.response);
											if(e.response.data){
												jQuery("#messageBox").html(
												'<div class="alert alert-danger alert-dismissible fade in" role="alert">'
													+ '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>'
													+ e.response.data.message
												+ '</div>');
												self.resposeCall(e.response.data);
											}
										});
									break;
									default:
									break;
								}
							}
						}
					});
				},
			});
		},
		resposeCall(z){
			var self = this;
			var rrr = {
				"id": 0,
				"recordId": '',
				"recordDateText": '',
				"data": self.record,
			};

			if(!z.status){
				console.log('Ocurrio un error resposeCall. !z.status', z.status);
			} else {
				if(z.status === 200){
					if(Number(z.data) > 0 && Number(z.data) != 'NaN'){
						radID = (z.data);
						rrr.id = radID;
						self.callEvent(rrr);
						/*
						api.get('/records/' + self.table + '/' + radID)
						.then(function (a) {
							console.log('Existe a');
							if(a.data){
								console.log('Existe a.data', a.data);
								if(a.data.created !== undefined){
									radSeparate = a.data.created.split(" ");
									if(radSeparate[0] != undefined){
										console.log('Existe radSeparate');
										radFecha = radSeparate[0].split("-");
										if(radFecha.length === 3){
											console.log('Existe Fecha');
											rrr.recordId = radFecha[0] + radFecha[1] + radFecha[2] + self.zfill(radID, 5);
											rrr.recordDateText = radFecha[0] + radFecha[1] + radFecha[2];
											rrr.data = a.data;
										}
									}
								}else{
									console.log('no existe a.data.created', a.data);
								}
								self.callEvent(rrr);
							}
						});
						*/
					}
				}else{
					console.log("Console in resposeCall - rrr => ", rrr);
					self.callEvent(rrr);
				}
			}
		},
		MaysPrimera(string){
			return string.charAt(0).toUpperCase() + string.slice(1);
		},
		getOptionsInputs(){
			var self = this;
			if(self.options === undefined || self.options === null){
				self.options = {};
			}
			if(self.options_form != undefined){
				fields = (self.options_form.fields != undefined) ? self.options_form.fields : {};

				for (const [key, value] of Object.entries(fields)) {
					if(self.options[value.options] === undefined){
						self.options[value.options] = [{ text: "Seleccione una opcion.", value: "" }];
					}

					if((value.options != undefined)){
						api.get('/records/' + value.options, {
							params: {}
						})
						.then(function (r) {
							if(!r.status){
								alert('Ocurrio un error creando el campo del formulario. [' + key + ']');
							} else {
								if(r.status === 200){
									for (const [kRecord, vRecord] of Object.entries(r.data.records)) {
										if(vRecord.name != undefined && vRecord.code != undefined){
											self.options[value.options].push({ text: vRecord.code + ' - ' + vRecord.name, value: vRecord.id });
										} else if(vRecord.name != undefined && vRecord.code == undefined){
											self.options[value.options].push({ text: vRecord.name, value: vRecord.id });
										} else if(vRecord.names != undefined && vRecord.name == undefined){
											self.options[value.options].push({ text: vRecord.names, value: vRecord.id });
										} else if(vRecord.title != undefined && vRecord.subtitle == undefined && vRecord.name == undefined){
											self.options[value.options].push({ text: vRecord.title, value: vRecord.id });
										} else if(vRecord.title != undefined && vRecord.subtitle != undefined && vRecord.name == undefined){
											self.options[value.options].push({ text: self.MaysPrimera(vRecord.subtitle) + ' - ' + self.MaysPrimera(vRecord.title), value: vRecord.id });
										} else {
											self.options[value.options].push({ text: vRecord.id, value: vRecord.id });
										}
									};
								}
							}
						})
						.catch(function (e) {
							console.log(e);
						});
					}
				}
				self.getOptions();
			} else {
				console.log('options_form no definido.');
			}

			self.getValidatorForm();
		},
		createFormElement(fields){
			var self = this;
			if(fields == undefined || fields == null){ fields = []; };

			var returnData = {
				"fields": fields,
				"inputs": [],
				"record": {},
				"othersRecord": {},
				"rules": {}
			};

			for (const [key, value] of Object.entries(fields)) {
				var optionsRule = {};
				var optionsInput = {};
				// if((value.show !== undefined)){ optionsRule.show = value.show; } else { optionsRule.show = true; }
				if((value.required !== undefined)){ optionsRule.required = value.required; } else {}
				if((value.remote !== undefined)){ optionsRule.remote = value.remote; } else {}
				if((value.min !== undefined)){ optionsRule.min = value.min; } else {}
				if((value.max !== undefined)){ optionsRule.max = value.max; } else {}
				if((value.email !== undefined)){ optionsRule.email = value.email; } else {}
				if((value.minlength !== undefined)){ optionsRule.minlength = value.minlength; } else {}
				if((value.maxlength !== undefined)){ optionsRule.maxlength = value.maxlength; } else {}
				if((value.rangelength !== undefined)){ optionsRule.rangelength = value.rangelength; } else {}
				if((value.range !== undefined)){ optionsRule.range = value.range; } else {}
				if((value.step !== undefined)){ optionsRule.step = value.step; } else {}
				if((value.date !== undefined)){ optionsRule.date = value.date; } else {}
				if((value.dateISO !== undefined)){ optionsRule.dateISO = value.dateISO; } else {}
				if((value.url !== undefined)){ optionsRule.url = value.url; } else {}
				if((value.number !== undefined)){ optionsRule.number = value.number; } else {}
				if((value.digits !== undefined)){ optionsRule.digits = value.digits; } else {}
				if((value.equalTo !== undefined)){ optionsRule.equalTo = value.equalTo; } else {}

				// for (const [kValue, vValue] of Object.entries(value)) {};

				optionsInput.name = key;
				if(value.label !== undefined){ optionsInput.label = value.label; } else { optionsInput.label = key; }
				if(value.required !== undefined){ optionsInput.required = value.required; } else { optionsInput.required = false; }
				if(value.readonly !== undefined){ optionsInput.readonly = value.readonly; } else { optionsInput.readonly = false; }
				if(value.disabled !== undefined){ optionsInput.disabled = value.disabled; } else { optionsInput.disabled = false; }
				if(value.value !== undefined){
					optionsInput.value = value.value;
					// returnData.record[key] = value.value;
				} else {
					optionsInput.value = null;
					// returnData.record[key] = null;
				}
				if(value.show !== undefined){ optionsInput.show = value.show; } else { optionsInput.show = true; }


				// returnData.record[key] = value.value;
				if((value.typeInput != undefined)){
					switch(value.typeInput){
						case 'checkbox':
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'checkbox';
						break;
						case 'text':
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'text';
						break;
						case 'email':
							// returnData.record[key] = '';
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'email';
						break;
						case 'textarea':
							// returnData.record[key] = '';
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'textarea';
						break;
						case 'date':
							// returnData.record[key] = '';
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'date';
						break;
						case 'dateISO':
							// returnData.record[key] = '';
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'dateISO';
						break;
						case 'datetime':
							// returnData.record[key] = '';
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'datetime';
						break;
						case 'datetime-local':
							// returnData.record[key] = '';
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'datetime-local';
						break;
						case 'time':
							// returnData.record[key] = '';
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'input';
							optionsInput.type = 'time';
						break;
						case 'number':
							// returnData.record[key] = 0;
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : 0;
							optionsInput.tag = 'input';
							optionsInput.type = 'number';
						break;
						case 'select':
							// returnData.record[key] = 0;
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : 0;
							optionsInput.tag = 'select';
							if((value.options != undefined)){
								if(self.options[value.options] != undefined){ optionsInput.options = self.options[value.options]; }
							}
						break;
						case 'section':
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
							optionsInput.tag = 'span';
							optionsInput.type = 'section';
						break;
						default:
							optionsInput.tag = 'input';
							optionsInput.type = value.type;

							// returnData.record[key] = null;
							returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
						break;
					}
				} else {
					//returnData.record[key] = null;
					returnData.record[key] = (optionsInput.value != null) ? optionsInput.value : '';
					optionsInput.tag = 'none';
				}
				optionsInput.title = value.label;
				optionsInput.value = returnData.record[key];

				if(value.valueDataDynamic != undefined){
					self.getValueDataDynamic(value, optionsInput);
				}

				if(optionsInput.show == false){ optionsInput.tag = 'input'; optionsInput.type = 'hidden'; };
				// self.inputs.push(optionsInput);
				// self.rules[key] = optionsRule;

				returnData.inputs.push(optionsInput);
				returnData.rules[key] = optionsRule;
			}
			return returnData;
		},
		getValueDataDynamic(value, optionsInput){
			var self = this;
			// validar si existen fields
			if(value.valueDataDynamic.fields != undefined && value.valueDataDynamic.result != undefined){
				optionsInput.readonly = true;
				optionsInput.dynamic = true;
				optionsInput.result = value.valueDataDynamic.result;
				optionsInput.dynamicOptions = self.createFormElement(value.valueDataDynamic.fields);

				for (const [kDynamic, vDynamic] of Object.entries(optionsInput.dynamicOptions.record)) {
					// console.log(kDynamic, vDynamic);
					//self.otherRecords.push(console.log(kDynamic));
					if(self.otherRecords[kDynamic] == undefined || self.otherRecords[kDynamic] == null){
						self.otherRecords[kDynamic] = vDynamic;
					}
				};
			}
			return { "value": value, "optionsInput": optionsInput }
		},
		getOptions(){
			var self = this;
			self.rules = {};
			self.record = {};
			self.inputs = [];
			if(self.options_form != undefined){
				self.action = (self.options_form.action != undefined) ? self.options_form.action : 'view';
				self.title = (self.options_form.titulo != undefined) ? self.options_form.titulo : '';
				self.subtitle = (self.options_form.subtitulo != undefined) ? self.options_form.subtitulo : '';
				self.contentDescription = (self.options_form.descripcion != undefined) ? self.options_form.descripcion : '';
				self.table = (self.options_form.tabla != undefined) ? self.options_form.tabla : 'none';
				self.idUpdate = (self.options_form.id_edit != undefined) ? self.options_form.id_edit : 0;
				self.callEvent = (self.options_form.callEvent != undefined) ? self.options_form.callEvent : function(){
					console.log("No hay respuesta configurada.");
				};
				fields = (self.options_form.fields != undefined) ? self.options_form.fields : {};
				fieldsRepair = self.createFormElement(fields);

				if(fieldsRepair.record != undefined){ self.record = fieldsRepair.record; };
				if(fieldsRepair.inputs != undefined){ self.inputs = fieldsRepair.inputs; };
				if(fieldsRepair.rules != undefined){ self.rules = fieldsRepair.rules; };
			} else {
				console.log('options_form no definido.');
			}

			self.getValidatorForm();
		},
	},
	computed: {
	},
});
</script>
